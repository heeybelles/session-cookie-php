CREATE DATABASE IF NOT EXISTS bd_associacao;
USE bd_associacao;

-- Usuários (administradores e funcionários)
CREATE TABLE IF NOT EXISTS usuario (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    senha VARCHAR(255) NOT NULL,
    foto VARCHAR(255),
    nivel ENUM('Administrador', 'Funcionário') NOT NULL,
    cargo_funcionario VARCHAR(100),
    data_admissao_funcionario DATE,
    idade INT,
    horario_inicio TIME,
    horario_termino TIME
);

-- Animais
CREATE TABLE IF NOT EXISTS animal (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    tipo_animal VARCHAR(100) NOT NULL,
    raca VARCHAR(100) NOT NULL,
    descricao VARCHAR(255) NOT NULL,
    foto VARCHAR(255),
    status ENUM('Chegou', 'Em avaliação', 'Em adoção', 'Adotado') DEFAULT 'Chegou',
    vacinado ENUM('Sim','Não') DEFAULT 'Não',
    idade INT,
    observacao_animal TEXT,
    adaptacao TEXT,
    data_chegada DATE,
    porte ENUM('Pequeno','Médio','Grande')
);

-- Adoções
CREATE TABLE IF NOT EXISTS adocao (
    id INT AUTO_INCREMENT PRIMARY KEY,
    animal_id INT NOT NULL,
    adotante_nome VARCHAR(100) NOT NULL,
    adotante_contato VARCHAR(100),
    data_adocao DATE NOT NULL,
    processo_adaptacao TEXT,
    FOREIGN KEY (animal_id) REFERENCES animal(id)
);

-- Padrinhos
CREATE TABLE IF NOT EXISTS padrinho (
    id INT AUTO_INCREMENT PRIMARY KEY,
    animal_id INT NOT NULL,
    padrinho_nome VARCHAR(100) NOT NULL,
    padrinho_contato VARCHAR(100),
    data_inicio DATE NOT NULL,
    observacao TEXT,
    FOREIGN KEY (animal_id) REFERENCES animal(id)
);

-- Observações detalhadas do animal
CREATE TABLE IF NOT EXISTS observacoes_animal (
    id INT AUTO_INCREMENT PRIMARY KEY,
    animal_id INT NOT NULL,
    data_observacao DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    tipo ENUM('Saúde','Comportamento','Adaptação','Administrativa') NOT NULL,
    observacao TEXT NOT NULL,
    funcionario_id INT,
    FOREIGN KEY (animal_id) REFERENCES animal(id),
    FOREIGN KEY (funcionario_id) REFERENCES usuario(id)
);

-- Doações
CREATE TABLE IF NOT EXISTS doacoes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    tipo ENUM('Coberta','Ração','Higienicos','Medicamento','Outro') NOT NULL,
    descricao VARCHAR(255),
    quantidade INT NOT NULL,
    data_doacao DATE NOT NULL,
    doador_nome VARCHAR(100),
    foto VARCHAR(255),
    observacao TEXT
);

-- Estoque
CREATE TABLE IF NOT EXISTS estoque (
    id INT AUTO_INCREMENT PRIMARY KEY,
    item_nome VARCHAR(100) NOT NULL,
    tipo ENUM('Ração','Medicamento','Higienicos','Coberta','Outro') NOT NULL,
    quantidade INT NOT NULL,
    validade DATE,
    observacao TEXT,
    doacao_id INT,
    FOREIGN KEY (doacao_id) REFERENCES doacoes(id)
);

-- Agenda de eventos
CREATE TABLE IF NOT EXISTS agenda_eventos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    titulo VARCHAR(100) NOT NULL,
    descricao TEXT,
    data_inicio DATE NOT NULL,
    data_termino DATE,
    horario_inicio TIME NOT NULL,
    horario_termino TIME,
    status ENUM('Concluido','Em breve','A concluir') DEFAULT 'A concluir',
    local VARCHAR(100)
);

-- Voluntários
CREATE TABLE IF NOT EXISTS voluntario (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    foto VARCHAR(255),
    email VARCHAR(100),
    telefone VARCHAR(20),
    idade INT,
    horario_inicio TIME,
    horario_termino TIME,
    data_inicio DATE,
    disponibilidade ENUM('Segunda','Terça','Quarta','Quinta','Sexta','Sábado','Domingo','Variável'),
    observacao TEXT
);


                                    --------SELECTS---------

------------------------------------------------------------------------------------------
CRUD -> Animal

SELECT * FROM animal WHERE id = ?";

SELECT 
    a.id AS animal_id,
    a.nome AS nome_animal,
    a.raca,
    a.status,
    ad.id AS adocao_id,
    ad.adotante_nome,
    ad.adotante_contato,
    ad.data_adocao,
    ad.processo_adaptacao
FROM animal a
LEFT JOIN adocao ad ON a.id = ad.animal_id
WHERE a.id = ?;

INSERT INTO animal (nome, tipo_animal, raca, descricao, porte, data_chegada, status)
VALUES (?, ?, ?, ?, ?, ?, ?);

UPDATE animal 
            SET nome = ?, raca = ?, descricao = ?, status = ?
            WHERE id = ?"

DELETE FROM animal WHERE id = ?

-------------------------------------------------------------------------------------------
CRUD -> Adoções

SELECT * FROM adocao WHERE id = ?";

UPDATE adocao SET adotante_nome=?, adotante_contato=?, data_adocao=?, processo_adaptacao=?
WHERE id=?

DELETE FROM adocao WHERE id=?

SELECT 
    a.id,
    a.nome AS animal,
    a.raca,
    a.status,
    p.padrinho_nome,
    ad.adotante_nome,
    ad.data_adocao
FROM animal a
LEFT JOIN padrinho p ON a.id = p.animal_id
LEFT JOIN adocao ad ON a.id = ad.animal_id
WHERE a.id = ?

INSERT INTO adocao (animal_id, adotante_nome, adotante_contato, data_adocao, processo_adaptacao)
VALUES (?, ?, ?, ?, ?)
--------------------------------------------------------------------------------------------

CRUD -> Padrinhos

SELECT 
    p.id AS padrinho_id,
    p.padrinho_nome,
    p.padrinho_contato,
    p.data_inicio,
    p.observacao AS observacao_padrinho,
    a.id AS animal_id,
    a.nome AS nome_animal,
    a.raca,
    a.status
FROM padrinho p
JOIN animal a ON p.animal_id = a.id
WHERE p.id = ?;

INSERT INTO padrinho (animal_id, padrinho_nome, padrinho_contato, data_inicio, observacao)
VALUES (?, ?, ?, ?, ?);

UPDATE padrinho
SET animal_id = ?, padrinho_nome = ?, padrinho_contato = ?, data_inicio = ?, observacao = ?
WHERE id = ?;

DELETE FROM padrinho WHERE id = ?;
-------------------------------------------------------------------------------------------

CRUD -> Usuário

SELECT * FROM usuario WHERE email = ?

INSERT INTO usuario (nome, email, senha, nivel, cargo_funcionario, data_admissao_funcionario)
        VALUES (?, ?, ?, ?, ?, ?)

UPDATE usuario SET nome=?, email=?, nivel=?, cargo_funcionario=?, horario_inicio=?, horario_termino=? WHERE id=?

DELETE FROM usuario WHERE id=?

--------------------------------------------------------------------------------------------
CRUD -> Estoque

SELECT 
    e.id,
    e.item_nome,
    e.tipo,
    e.quantidade,
    e.validade,
    e.observacao AS estoque_observacao,
    d.id AS doacao_id,
    d.doador_nome,
    d.data_doacao,
    d.tipo AS tipo_doacao,
    d.descricao AS descricao_doacao
FROM estoque e
LEFT JOIN doacoes d ON e.doacao_id = d.id
WHERE e.id = ?;

INSERT INTO estoque (item_nome, tipo, quantidade, validade, observacao, doacao_id)
VALUES (?, ?, ?, ?, ?, ?)

UPDATE estoque SET item_nome=?, tipo=?, quantidade=?, validade=?, observacao=?, doacao_id=? WHERE id=?

DELETE FROM estoque WHERE id=?

-------------------------------------------------------------------------------------------
CRUD -> Agenda

INSERT INTO agenda_eventos (titulo, descricao, data_inicio, data_termino, horario_inicio, horario_termino, status, local)
VALUES (?, ?, ?, ?, ?, ?, ?, ?)

UPDATE agenda_eventos SET titulo=?, descricao=?, data_inicio=?, data_termino=?, horario_inicio=?, horario_termino=?, status=?, local=? WHERE id=?

DELETE FROM agenda_eventos WHERE id=?

-------------------------------------------------------------------------------------------
CRUD -> Voluntário

-- Seleciona voluntário pelo ID
SELECT 
    id,
    nome,
    foto,
    email,
    telefone,
    idade,
    horario_inicio,
    horario_termino,
    data_inicio,
    disponibilidade,
    observacao
FROM voluntario
WHERE id = ?;

INSERT INTO voluntario 
(nome, foto, email, telefone, idade, horario_inicio, horario_termino, data_inicio, disponibilidade, observacao)
VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?);

UPDATE voluntario
SET nome=?, foto=?, email=?, telefone=?, idade=?, horario_inicio=?, horario_termino=?, data_inicio=?, disponibilidade=?, observacao=?
WHERE id=?;

DELETE FROM voluntario WHERE id=?;
